@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}

@{
    ViewData["Title"] = "Home Page";
}
<head>
    <link href="~/css/Admin Css/AdminFruit.css" rel="stylesheet" />
    <script type="text/javascript">
        var imgURL = "";
        $(document).ready(function () {
            if (sessionStorage.getItem("role") == "admin") {
                $("#IndexPage").show();
            }
            else {
                $("#unAuthorised").show();
            }
            $('#addFruit').click(function () {
                let jwtToken = sessionStorage.getItem("jwtToken");
                let userName = sessionStorage.getItem("userName");
                let name = $('#name').val();
                let price = $('#price').val();
                let qty = $('#quantity').val();
                var file = $("#selectedImg").get(0).files;
                console.log(file);

                imgURL = imgURL.replace('data:image/png;base64,', "");
                console.log(imgURL);


                let item = { fruitName: name, fruitPrice: price, fruitQty: qty, fruitImgFile: imgURL };
                console.log(item);


                $.ajax({
                    url: 'https://localhost:44329/api/AdminFruit',
                    type: 'POST',
                    data: JSON.stringify(item),
                    contentType: "application/json",
                    headers: {
                        Authorization: 'Bearer ' + jwtToken
                    },
                    success: function (result, status, xhr) {

                        alert("Fruit " + result.fruitName + " added to the website");
                        window.location.reload();

                    },
                    error: function (xhr, textStatus, errorThrown) {
                        alert("Error Occured: " + xhr.responseText);
                        console.log(xhr.responseText);

                    }
                });
            });

        });
        function readURL(input) {
            console.log(input.files);

            if (input.files && input.files[0]) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    $('#previewImage')
                        .attr('src', e.target.result)
                        .width(100)
                        .height(100);
                    imgURL = reader.result;
                };

                reader.readAsDataURL(input.files[0]);
                return imgURL
            }
        }



    </script>
</head>

<h1 class="text-center" id="unAuthorised" style="display:none"> you are not authorised to view this page</h1>

<div id="fruit">

    <div class="container">
        <div id="fruit-row" class="row justify-content-center align-items-center">
            <div id="fruit-column" class="col-md-6">
                <div id="fruit-box" class="col-md-12">
                    <form id="fruit-form" class="form">

                        <div class="form-group">
                            <label for="Fruitname" class="text-dark">Fruitname:</label><br>
                            <input type="text" name="Fruitname" id="name" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="FruitPrice" class="text-dark">FruitPrice:</label><br>
                            <input type="text" name="price" id="Fruitname" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="Quantity" class="text-dark">Quantity:</label><br>
                            <input type="text" name="Quantity" id="quantity" class="form-control">
                        </div>
                        <div class="form-group">
                            <label  class="text-dark">Upload Image:</label><br>
                            <input type='file' id="selectedImg" onchange="readURL(this)" />
                            <img id="previewImage" src="#" alt="your image" />
                        </div>

                        <button type="button"  id="addFruit" class="btn btn-success btn-lg" >Submit</button>

                    </form>
                </div>
            </div>
        </div>
    </div>
</div>


